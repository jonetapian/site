<html lang="pt">
  <head>
    
    <title>Beleza Pura</title>  
      
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../compiler/bootstrap.css">
    <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
    <link rel="stylesheet" href="../compiler/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css">
    <link rel="stylesheet" href="../social-login.css">
    <link rel="icon" href="../imgs/iconePizza.png" type="image/gif"> 
    <link href="https://fonts.googleapis.com/css?family=Port+Lligat+Slab&display=swap" rel="stylesheet">

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-app.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-database.js"></script>
    <script src="../scripts/firebase.js"></script>
      
    <script src="../scripts/Login.js"></script>
    <script src="../scripts/Produto.js"></script>
    <script src="../scripts/Produto_service.js"></script>
    <script src="../pizzas/pizzas_model.js"></script>
    <script src="../pizzas/pizzas_service.js"></script>
    <script src="../services/DataOp.js"></script>



      
    <script src="https://maps.googleapis.com/maps/api/js?libraries=places&language=en&key=AIzaSyAxUeOKkUigYadZ07KCQuBQLybgzE0foxc"async defer></script>

    
  </head>
    
  <body class="d-flex flex-column h-100 container-fluid">
         
          

              <nav class="navbar fixed-top navbar-expand-lg navbar-light corNav">

                  <div class="container-fluid line">

                      <a class="navbar-brand font corFont my-auto" href="#"><h4 class="my-0">Beleza Pura</h4></a>

                      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navBarSite">
                          <span class="navbar-toggler-icon"></span>
                      </button>

                      <div class="collapse navbar-collapse " id="navBarSite">

                          <ul class="navbar-nav mr-auto ml-3 ">
                              <li class="nav-item ">
                                  <a class="nav-link font ml-3 h5 my-0" href="index.html">Inicio</a>
                              </li>
                              <li class="nav-item dropdown">
                                  <a class="nav-link font ml-3 h5 my-0" href=pizzas.html>Pizzas</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link font ml-3 h5 my-0" href="esfihas.html">Esfihas</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link font ml-3 h5 my-0" href="porcoes.html">Fogazas e Porções</a>
                              </li>

                          </ul>

                          <ul class="navbar-nav">
                              <div class="dropdown">
                                  <li class="nav-item">

                                          <img src="../imgs/perfil.png" class="" id="dropdownPerfil" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false" style="width: 40px; height: 40px; cursor: pointer;">
                                          <div class="dropdown-menu dropdown-menu-right" aria-laballedby="dropdownPerfil">
                                              <a href="#" class="dropdown-item" data-toggle="modal" data-target="#divModal" id="btnMenuLogin" disabled>Fazer Login</a>
                                              <a href="#" class="dropdown-item" data-toggle="modal" data-target="#divModalCadastrar" id="btnMenuCadastro">Cadastrar-se</a>
                                              <div class="dropdown-divider"></div>
                                              <a href="#" class="dropdown-item" onclick="logout()" id="btnMenuSair">Sair</a>
                                          </div>


                                  </li>  
                              </div>

                          </ul>

                      </div>

                  </div>
              </nav>
                <div class="botaoFlutuante border border-light border-right-0" data-toggle="modal" data-target="#modalCarrinho">
              <img src="../imgs/carrinho.png" class="carrinhoFlutuante" >

          </div>
          <div class="card" style="margin-top: 85px !important;">
              <div class="card-body">
                  <div class="row">
                      <div class="col text-center">
                            <h1 class=" font">
                                    Configurar Dados
                            </h1>
                      </div>
                      

                  </div>
                  <div class="row">
                      <div class="col">
                            <h3 class="fontTexto">Modificar e excluir Dados</h3>
                      </div>
                  </div>
                  <form class="p-2">
                        <div class="form-group row">
                            <div class="dropdown col-auto ">
                                    <button class=" float-right btn btn-danger dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        produto
                                    </button>
                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" onclick="setProductType(1)">Pizza</a>
                                        <a class="dropdown-item" onclick="setProductType(2)">Esfiha</a>
                                        <a class="dropdown-item" onclick="setProductType(3)">Batata</a>
                                        <a class="dropdown-item" onclick="setProductType(4)">Fogazza</a>
                                        <a class="dropdown-item" onclick="setProductType(5)">Bebida</a>
                                    </div>
                            </div>
                        </div>
                        <div class="form-group row">
                                <div class="col" id="searchColumn" >
                                        <input type="text" class="form-control" id="searchBar"  placeholder="pesquise seu produto">
                                </div>
                                <div class="col-auto">
                                    <input type="button" class="btn btn-danger form-control" value="Pesquisar" onclick="searchProduct()">
                                </div>
                        </div>
                        <div class="form-group-row">
                            <div class="list-group " id="ItemList">
                                <div class="row">
                                    <div class="col" id="itemList1">
                                    </div>
                                    <div class="col" id="itemList2">
                                    </div>
                                    <div class="col" id="itemList3">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div  id="formMod" hidden>
                            <div class="form-group row" >
                                <label for="inputIngredientes" class="col-sm-2 col-form-label fontTexto">ingredientes:</label>
                                <div class="col-sm-10">
                                  <input type="text" class="form-control" id="inputIngredientesModificar" placeholder="use ',' para separar os ingredientes">
                                </div>
                              </div>
                              <div class="form-group row">
                                  <label for="inputTipo" class="col-sm-2 col-form-label fontTexto">Tipo:</label>
                                  <div class="col-sm-10">
                                      <input type="text" class="form-control" id="inputIngredientesProcurar" placeholder="tipo">
                                  </div>
                              </div>
                        </div>
                        
                      </form>
                  
              <div class="row">
                    <div class="col">
                          <h3 class="fontTexto">Adicionar Dados</h3>
                    </div>
                </div>
                <form class="p-2" >
                    <div id="formAdicionar">
                      <div class="form-group row">
                              <div class="dropdown col-sm-2">
                                      <button class="btn btn-danger dropdown-toggle" type="button" id="btnType" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        produto
                                      </button>
                                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item"  onclick="setProductType(1,true)" >Pizza</a>
                                        <a class="dropdown-item"  onclick="setProductType(2,true)" >Esfiha</a>
                                        <a class="dropdown-item"  onclick="setProductType(3,true)" >Batata</a>
                                        <a class="dropdown-item"  onclick="setProductType(4,true)">Fogazza</a>
                                        <a class="dropdown-item"  onclick="setProductType(5,true)" >Bebida</a>
                                      </div>
                                    </div>
                        <div class="col-sm-10">
                              <input type="text" class="form-control" id="inputNome" placeholder="nome">
                          </div>
                      </div>
                      <div class="form-group row">
                        <label for="inputIngredientes" class="col-sm-2 col-form-label fontTexto">ingredientes:</label>
                        <div class="col-sm-10">
                          <input type="text" class="form-control" id="inputIngredientes" placeholder="use ',' para separar os ingredientes">
                        </div>
                      </div>
                      <div class="form-group row">
                              <label for="inputTipo" class="col-sm-2 col-form-label fontTexto">Tipo:</label>
                              <div class="col-sm-10">
                                <label class=" fontTexto">Salgada</label>  <input type="radio" id="radioSalgada" name="tipo" class=" " value="Salgado" checked>
                                  <label class="fontTexto ml-3" >Doce </label> <input type="radio" class="" id="radioDoce" name="tipo" value="Doce">
                              </div>
                            </div>

                      <div class="form-group row">
                          <label for="inputValor" class="col-sm-2 col-form-label fontTexto">Valor:</label>
                          <div class="col-sm-10">
                            <input type="number" class="form-control" id="inputValor" placeholder="valor em reais ">

                          </div>
                          
                      </div>
                    </div>
                    <div class="row">
                            <div class="col-sm">
                                    <button type="reset" class="btn-sm btn-success float-right" onclick="getAllInputData()">
                                        Adicionar
                                    </button>
                            </div>
                            
                        </div>
                    </form>

              
            </div>
          </div>
          <div class="modal fade" id="divModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title font" id="exampleModalLabel">Fazer login</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="caixa-email" class="col-form-label font">Email:</label>
                                <input type="email" id="txtEmail" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="caixa-senha" class="col-form-label font">Senha:</label>
                                <input type="password" id="txtSenha" class="form-control">
                            </div>
                            
                        </form>
                    </div>
                    <div class="modal-footer font">
                        <a href="#" class="mr-auto text-danger" data-toggle="modal" data-target="#divModalCadastrar" data-dismiss="modal">Cadastrar-se</a>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="submit" id="btnLogin" class="btn btn-danger">Entrar</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="divModalEdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title font" id="exampleModalLabel">Editar</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                                <div class="form-group row">
                                    <div class="col-sm-2">
                                        <label class="font" for="inputNomeModal">Nome:</label>
                                    </div>
                                  <div class="col-sm-10">
                                        <input type="text" class="form-control" id="inputNomeModal">
                                    </div>
                                </div>
                                <div class="form-group row">
                                  <label for="inputIngredientes" class="col-sm-2 col-form-label fontTexto">ingredientes:</label>
                                  <div class="col-sm-10">
                                    <input type="text" class="form-control" id="inputIngredientesModal" >
                                  </div>
                                </div>
                                <div class="form-group row">
                                        <label for="inputTipo" class="col-sm-2 col-form-label fontTexto">Tipo:</label>
                                        <div class="col-sm-10">
                                          <label class=" fontTexto">Salgada</label>  <input type="radio" id="radioSalgadaModal" name="tipoModal" class=" " value="Salgado">
                                            <label class="fontTexto ml-3" >Doce </label> <input type="radio" class="" id="radioDoceModal" name="tipoModal" value="Doce">
                                        </div>
                                      </div>
          
                                <div class="form-group row">
                                    <label for="inputValorModal" class="col-sm-2 col-form-label fontTexto">Valor:</label>
                                    <div class="col-sm-10">
                                      <input type="number" class="form-control" id="inputValorModal">
          
                                    </div>
                                    
                                </div>
                                <div class="form-group row">
                                    <div class="col">
                                        <button type="button" style="width: 100%;" class="btn btn-warning" data-dismiss="modal" onclick="deleteProduct()">Excluir</button>
                                    </div>
                                        <div class="col">
                                            <button type="button"style="width: 100%;" class="btn btn-danger" onclick="updateProduct()" data-dismiss="modal">Salvar alterações</button>
                                        </div>
                                        
                                    </div>
                              </div>
                              </form>
                        </div>
                    </div>
                </div>
            </div>
      

      
    <script>
        var path = '';
        var selected_product = new Array();

        function setProductType(value,from_add){
            if(value){
                var drop = document.getElementById("btnType");
                switch(value){
                    case(1):
                        
                        path = "pizzas";
                        if(from_add){
                            drop.innerHTML = "Pizza";
                            restoreForm();
                        }else{
                            fillOptions("pizzas");
                        }
                        
                    return;
                    case(2):
                        
                        path = "esfihas";
                        if(from_add){
                            drop.innerHTML = "Esfiha";
                            restoreForm();
                        }else{
                            fillOptions("esfihas");
                        }
                    return;
                    case(3):
                        
                        path = "batatas";
                        if(from_add){
                            drop.innerHTML = "Batata";
                            restoreForm();
                        }else{
                            fillOptions("batatas");
                        }
                    return;
                    case(4):
                        
                        path = "fogazza";
                        if(from_add){
                            drop.innerHTML = "Fogazza";
                            restoreForm();
                        }else{
                            fillOptions("fogazza");
                        }
                    return;
                    case(5):
                        
                        path = "bebidas";
                        if(from_add){
                            drop.innerHTML = "Bebida";
                            ChangeFormBebida();
                        }else{
                            fillOptions("bebidas");
                        }
                        
                    return;
                }
            }
        }
        //desativar campos que não servem pra bebida
        function ChangeFormBebida(){
            document.getElementById("inputIngredientes").disabled = true;
            document.getElementById("radioSalgada").disabled = true;
            document.getElementById("radioDoce").disabled = true;
            var card=['<div class="form-group row" id="bebidaForm"><label for="inputTamanho" class="col-sm-2 col-form-label fontTexto">Tamanho:</label><div class="col-sm-10"><input type="text" class="form-control" id="inputBebidaTamanho" placeholder="tamanho da bebida  "></div></div>'];
            document.getElementById("formAdicionar").innerHTML += card;
        }
        function restoreForm(){
            document.getElementById("inputIngredientes").disabled = false;
            document.getElementById("radioSalgada").disabled = false;
            document.getElementById("radioDoce").disabled = false;
            var formBebida = document.getElementById("bebidaForm");
            if(formBebida){
                formBebida.style.display = "none";
            }
        }
        function getAllInputData(){
            var nome = document.getElementById("inputNome").value;
            var valor = document.getElementById("inputValor").value;
            if(path){
                if(path != "bebidas"){
                var ingredientes = document.getElementById("inputIngredientes").value;
                if(document.querySelector('input[name = tipo]:checked') != null){
                    if(nome){
                        if(ingredientes){
                            var tipo = document.querySelector('input[name = tipo]:checked').value;
                            var obj = {'nome':nome,'valor':valor,'detalhes':ingredientes,'tipo':tipo};
                            alert(path);
                            sendToFirebase( path,obj);
                            console.log(obj);
                        }else{
                            alert("insira os ingredientes")
                        }
                        
                    }else{
                        alert("insira um nome")
                    }
                     
                }else{
                    alert("por favor selecione um tipo");
                }
            }else if(path == "bebidas"){
                
                var tamanho_bebidas = document.getElementById("inputBebidaTamanho").value;
                var obj = {'nome' : nome,'valor': valor,'tamanho': tamanho_bebidas};
                console.log(obj);
                alert(tamanho_bebidas);
            }
        }else{
            alert("escolha um produto");
        }
            
            
        }
        function sendToFirebase(url,obj){
            if(obj){
                var sender = new DataOp();
                DataOp.set(url + "/" + obj.nome,obj);
            }
        }
        function object_to_array(obj){
            const keys = Object.keys(obj)
            let array = new Array();
                for (const key of keys) {
                  array.push(obj[key]);
                }
            return array
        }
        function empty_columns(){
            document.getElementById('itemList1').innerHTML='';
            document.getElementById('itemList2').innerHTML='';
            document.getElementById('itemList3').innerHTML='';
        }
        function fillOptions(path){
            var get = new DataOp();
            const check_is_first = document.getElementById('itemList1').innerHTML;
            if(check_is_first !== ''){
                empty_columns();    
            }

            DataOp.get(path + "/").then(val =>{

                selected_product = object_to_array(val);
                fillProductColumns(selected_product);
            });

        }
        function fillProductColumns(array_products){
            var itens_column_1 = [];
            var itens_column_2 = [];
            var itens_column_3 = [];
            let tamanho_array = array_products.length;
            var counter = 0;
            let divid =  Math.floor(tamanho_array /3)    
            for(let pizza of array_products){

            if(counter < divid){
                if(pizza){
                itens_column_1 += ['<button type="button" id="btn'+ pizza.nome +'" value="'+ pizza.nome +'" onclick="fillModal(this.value)" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#divModalEdit" >'+ pizza.nome+'</button>'];
                
                }
            }else if(counter < divid *2){
                if(pizza){
                itens_column_2 += ['<button type="button" id="btn'+ pizza.nome +'" value="'+ pizza.nome +'" onclick="fillModal(this.value)" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#divModalEdit" onclick="fillModal">'+ pizza.nome+'</button>'];
                
                }
            }
            else{
                if(pizza){
                itens_column_3 += ['<button type="button" id="btn'+ pizza.nome +'" value="'+ pizza.nome +'" onclick="fillModal(this.value)" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#divModalEdit" onclick="fillModal">'+ pizza.nome+'</button>'];
                }
            }

            counter +=1;
            }
            document.getElementById('itemList1').innerHTML += itens_column_1;
            document.getElementById('itemList2').innerHTML += itens_column_2;
            document.getElementById('itemList3').innerHTML += itens_column_3;
        }
        function searchProduct(){
            empty_columns();
            var search = document.getElementById('searchBar').value;
            search = search.charAt(0).toUpperCase() + search.slice(1);
            console.log(search);
            let new_array = new Array();
            for(let product of selected_product){
                if(product.nome){
                    if(product.nome.startsWith(search)){
                        new_array.push(product);
                    }
                }
            }
            empty_columns();
            fillProductColumns(new_array);
        }
        function fillModal(value){
            console.log(selected_product);
            const editProduct = selected_product.find(product => product.nome === value);
            console.log(editProduct);
            document.getElementById('inputNomeModal').value = editProduct.nome;
            document.getElementById('inputIngredientesModal').value = editProduct.detalhes;
            //document.getElementById('inputNoModal').value = editProduct.nome;
            if(editProduct.tipo.toLowerCase() == "salgado"){
                document.getElementById('radioSalgadaModal').checked = true;
            }else{
                document.getElementById('radioDoceModal').checked = true;
            }
            document.getElementById('inputValorModal').value = editProduct.valor;

        }
        function updateProduct(){
            let nome = document.getElementById('inputNomeModal').value;
            let ingredientes = document.getElementById('inputIngredientesModal').value;
            let valor = document.getElementById('inputValorModal').value;
            let tipo = document.querySelector('input[name = tipoModal]:checked').value;
            console.log(tipo);
            var obj = {
                'nome':nome,
                'detalhes': ingredientes,
                'tipo':tipo,
                'valor':valor
            };
            const editProduct = selected_product.findIndex(product => product.nome === obj.nome);
            selected_product[editProduct] = obj;
            sendToFirebase(path,obj);

        }
        function deleteProduct(){
            let nome = document.getElementById('inputNomeModal').value;

            const editProduct = selected_product.findIndex(product => product.nome === nome);

            document.getElementById('btn' + nome).style.display = 'none';
            selected_product.pop(editProduct);
            DataOp.delete(path + "/" + nome );
        } 
        function logout(){
            
            firebase.auth().signOut().then(function(){
                localStorage.removeItem("email");
                window.location.reload(true);
            }).catch(function(error){
                
            });
            
        }
        (function(){
            var teste = localStorage.getItem("email");
            console.log(teste);
            if(teste){
                const btnMenuLogin = document.getElementById('btnMenuLogin');
                const btnMenuCadastrar = document.getElementById('btnMenuCadastro');
                btnMenuLogin.classList.add("disabled");
                btnMenuCadastrar.classList.add("disabled");
            }else{
                const btnMenuSair = document.getElementById('btnMenuSair');
                btnMenuSair.classList.add("disabled");
            }
            
            const txtEmail = document.getElementById('txtEmail');
            const txtSenha = document.getElementById('txtSenha');
            const btnLogin = document.getElementById('btnLogin');
            var logar;
            logar = new Login();

            btnLogin.addEventListener('click', e => {
                
                const emailLogin = txtEmail.value;
                const senhaLogin = txtSenha.value;
                
                btnLogin.addEventListener("teste", function(e){

                    logar.logar(emailLogin, senhaLogin);
                    
                    
                }, false);

                var event = new CustomEvent("teste", {detail: {beleza: true}}); 

                btnLogin.dispatchEvent(event);
                
                logar.verificarPersistencia();
                var url = window.location.href;
                console.log(url);
                
                
            });
            
            const txtEmailCadastrar = document.getElementById('txtEmailCadastrar');
            const txtSenhaCadastrar = document.getElementById('txtSenhaCadastrar');
            const btnCadastrar = document.getElementById('btnCadastrar');
            const txtNomeCadastrar = document.getElementById('txtNomeCadastrar');
            const txtConfirmarSenhaCadastrar = document.getElementById('txtConfirmarSenhaCadastrar');
            
            btnCadastrar.addEventListener('click', e => {
                const emailCadastrar =  txtEmailCadastrar.value;
                const senhaCadastrar =  txtSenhaCadastrar.value;
                const nomeCadastrar = txtNomeCadastrar.value;
                const confirmarSenha = txtConfirmarSenhaCadastrar.value;
                
                if(emailCadastrar != "" && senhaCadastrar != "" && nomeCadastrar != "" && senhaCadastrar === confirmarSenha){
                   logar.cadastrar(emailCadastrar, senhaCadastrar, nomeCadastrar);
                }else{
                   alert("Digite todos os campos");
                }
                
                
            });


            
            
            window.addEventListener('load', function(){
                
                logar.verificarPersistencia();
            });
            
        }());
        
    </script>
    <script src="../dist/jqueryjs/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
    <script src="../dist/popperjs/popper.js"></script>
    <script src="../dist/bootstrapjs/bootstrap.js"></script>
  </body>
    
</html>